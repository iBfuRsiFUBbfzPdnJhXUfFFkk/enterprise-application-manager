{% load templatetags_markdown %}

<div class="comment-item flex gap-4 p-4 border-b border-gray-100 last:border-b-0" data-comment-id="{{ comment.id }}">
    <!-- Avatar -->
    <div class="flex-shrink-0">
        <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-semibold text-sm">
            {% if comment.created_by %}
                {{ comment.created_by.username|slice:":2"|upper }}
            {% else %}
                ??
            {% endif %}
        </div>
    </div>

    <!-- Content -->
    <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2 mb-1">
            <span class="font-medium text-gray-900">
                {% if comment.created_by %}
                    {{ comment.created_by.username }}
                {% else %}
                    Unknown
                {% endif %}
            </span>
            <span class="text-sm text-gray-500" title="{{ comment.created_at|date:'F j, Y, g:i:s A' }}">
                {{ comment.created_at|timesince }} ago
            </span>
            {% if comment.is_internal %}
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                    Internal
                </span>
            {% endif %}
        </div>

        <div class="prose prose-sm max-w-none text-gray-700">
            {{ comment.content|markdown }}
        </div>
    </div>

    <!-- Delete button (only for comment author) -->
    {% if user == comment.created_by %}
    <div class="flex-shrink-0">
        <button type="button"
                class="comment-delete-btn p-1 text-gray-400 hover:text-red-600 transition-colors"
                data-comment-id="{{ comment.id }}"
                title="Delete comment">
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
        </button>
    </div>
    {% endif %}
</div>
