{% extends 'authenticated/base_authenticated.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header Section -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex items-center mb-4">
                <a href="{% url 'recommendation' %}" class="mr-4 text-gray-400 hover:text-gray-600 transition-colors duration-150">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>
                <div class="flex-1">
                    <h1 class="text-3xl font-bold text-gray-900">{{ recommendation.name }}</h1>
                    <p class="mt-1 text-sm text-gray-500">Recommendation Details</p>
                </div>
                <div class="flex space-x-3">
                    <a href="/authenticated/recommendation/export/docx/?ids={{ recommendation.id }}"
                       class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-150">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                        </svg>
                        Print
                    </a>
                    <a href="{% url 'recommendation_edit' model_id=recommendation.id %}"
                       class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-150">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        Edit
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="space-y-6">
            <!-- Metadata Section -->
            {% if recommendation.application or recommendation.project or recommendation.estimation or recommendation.person_recommended_by or recommendation.date_recommended %}
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Metadata</h2>
                </div>
                <div class="px-6 py-6">
                    <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% if recommendation.person_recommended_by %}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Recommended By</dt>
                            <dd class="mt-1 text-sm text-gray-900">
                                {% if recommendation.person_recommended_by.full_name_for_human %}
                                    {{ recommendation.person_recommended_by.full_name_for_human }}
                                {% else %}
                                    {{ recommendation.person_recommended_by }}
                                {% endif %}
                            </dd>
                        </div>
                        {% endif %}

                        {% if recommendation.date_recommended %}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Date Recommended</dt>
                            <dd class="mt-1 text-sm text-gray-900">{{ recommendation.date_recommended }}</dd>
                        </div>
                        {% endif %}

                        {% if recommendation.application %}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Related Application</dt>
                            <dd class="mt-1 text-sm text-gray-900">
                                {% if recommendation.application.acronym %}
                                    {{ recommendation.application.acronym }} - {{ recommendation.application.name }}
                                {% else %}
                                    {{ recommendation.application.name }}
                                {% endif %}
                            </dd>
                        </div>
                        {% endif %}

                        {% if recommendation.project %}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Related Project</dt>
                            <dd class="mt-1 text-sm text-gray-900">
                                {% if recommendation.project.name %}
                                    {{ recommendation.project.name }}
                                {% else %}
                                    {{ recommendation.project }}
                                {% endif %}
                            </dd>
                        </div>
                        {% endif %}

                        {% if recommendation.estimation %}
                        <div>
                            <dt class="text-sm font-medium text-gray-500">Related Estimation</dt>
                            <dd class="mt-1 text-sm text-gray-900">
                                {% if recommendation.estimation.name %}
                                    {{ recommendation.estimation.name }}
                                {% else %}
                                    {{ recommendation.estimation }}
                                {% endif %}
                            </dd>
                        </div>
                        {% endif %}
                    </dl>
                </div>
            </div>
            {% endif %}

            <!-- Description Section -->
            {% if description_html %}
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Description</h2>
                </div>
                <div class="px-6 py-6">
                    <div class="prose prose-sm max-w-none">
                        {{ description_html|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Rationale Section -->
            {% if rationale_html %}
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Rationale</h2>
                </div>
                <div class="px-6 py-6">
                    <div class="prose prose-sm max-w-none">
                        {{ rationale_html|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Benefits Section -->
            {% if benefits_html %}
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Expected Benefits</h2>
                </div>
                <div class="px-6 py-6">
                    <div class="prose prose-sm max-w-none">
                        {{ benefits_html|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Risks Section -->
            {% if risks_html %}
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Potential Risks</h2>
                </div>
                <div class="px-6 py-6">
                    <div class="prose prose-sm max-w-none">
                        {{ risks_html|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Additional Notes Section -->
            {% if comment_html %}
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Additional Notes</h2>
                </div>
                <div class="px-6 py-6">
                    <div class="prose prose-sm max-w-none">
                        {{ comment_html|safe }}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Related Links Section -->
            {% if recommendation.links.all %}
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">Related Links</h2>
                </div>
                <div class="px-6 py-6">
                    <ul class="space-y-3">
                        {% for link in recommendation.links.all %}
                        <li class="flex items-start">
                            <svg class="h-5 w-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                            </svg>
                            <div class="flex-1">
                                <div class="font-medium text-gray-900">{{ link.name }}</div>
                                <a href="{{ link.url }}" target="_blank" rel="noopener noreferrer" class="text-sm text-blue-600 hover:text-blue-800 break-all">
                                    {{ link.url }}
                                    <svg class="inline-block h-3 w-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                </a>
                                {% if link.comment %}
                                <p class="text-sm text-gray-600 mt-1">{{ link.comment }}</p>
                                {% endif %}
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Prose styles for rendered markdown */
    .prose h1 { font-size: 1.5em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
    .prose h2 { font-size: 1.3em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
    .prose h3 { font-size: 1.1em; font-weight: bold; margin-top: 0.5em; margin-bottom: 0.5em; }
    .prose p { margin-bottom: 0.75em; }
    .prose ul, .prose ol { margin-left: 1.5em; margin-bottom: 0.75em; }
    .prose li { margin-bottom: 0.25em; }
    .prose code { background-color: #f3f4f6; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-family: monospace; font-size: 0.875em; }
    .prose pre { background-color: #f3f4f6; padding: 0.75rem; border-radius: 0.375rem; overflow-x: auto; margin-bottom: 0.75em; }
    .prose pre code { background-color: transparent; padding: 0; }
    .prose blockquote { border-left: 4px solid #d1d5db; padding-left: 1rem; margin-left: 0; margin-bottom: 0.75em; color: #6b7280; font-style: italic; }
    .prose a { color: #3b82f6; text-decoration: underline; }
    .prose a:hover { color: #2563eb; }
    .prose strong { font-weight: bold; }
    .prose em { font-style: italic; }
    .prose hr { border: 0; border-top: 1px solid #d1d5db; margin: 1em 0; }
    .prose table { border-collapse: collapse; width: 100%; margin-bottom: 0.75em; }
    .prose th, .prose td { border: 1px solid #d1d5db; padding: 0.5rem; text-align: left; }
    .prose th { background-color: #f3f4f6; font-weight: bold; }
</style>
{% endblock %}
